<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Mis Turnos</title>
	<!-- Favicon-->
	<link rel="icon" type="image/x-icon" href="assets/favicon.ico" />
	<!-- Bootstrap Icons-->
	<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css" rel="stylesheet" />
	<!-- Google fonts-->
	<link href="https://fonts.googleapis.com/css?family=Merriweather+Sans:400,700" rel="stylesheet" />
	<link href="https://fonts.googleapis.com/css?family=Merriweather:400,300,300italic,400italic,700,700italic" rel="stylesheet" type="text/css" />
	<!-- SimpleLightbox plugin CSS-->
	<link href="https://cdnjs.cloudflare.com/ajax/libs/SimpleLightbox/2.1.0/simpleLightbox.min.css" rel="stylesheet" />
	<!-- Core theme CSS (includes Bootstrap)-->
	<link href="/css/styles.css" rel="stylesheet" />
</head>
<body>
	<a th:href="@{/}" class="btn btn-primary">Volver al inicio</a><br></br>
    <h2>Consultar mis turnos</h2>

	<ul>
	  <li th:each="t : ${turnos}" th:text="${t.idTurn} + ' - ' + ${t.status} + ' - ' + ${t.employee.name} + ' - ' + ${t.date.date}"></li>
	</ul>
    <form th:action="@{/client/my-turns}" method="post">
        <label for="clientId">Ingresá tu ID de cliente:</label>
        <input type="number" name="clientId" th:value="${clientId}" required />
        <button type="submit">Ver Turnos</button>
    </form>

    <p th:if="${error}" th:text="${error}"></p>

	<div th:if="${turnosAgrupados}">
	    <h3>Lista de turnos</h3>

	    <div th:each="entry : ${turnosAgrupados}">
	        <h4 th:text="${entry.key}"></h4>
	        <table class="m-1 p-1 table table-dark table-striped">
	            <thead>
	                <tr>
	                    <th>Empleado</th>
	                    <th>Fecha</th>
	                    <th>Estado</th>
	                    <th>Observación</th>
	                </tr>
	            </thead>
	            <tbody>
	                <tr th:each="turno : ${entry.value}">
	                    <td th:text="${turno.employee != null ? turno.employee.name : 'Empleado no asignado'}"></td>
	                    <td th:text="${turno.date != null ? turno.date.date : 'Sin fecha'}"></td>
	                    <td th:text="${turno.date} != null ? ${#temporals.format(turno.date.hour, 'HH:mm ')}"></td>
	                    <td th:text="${turno.status}"></td>
	                    <td th:text="${turno.observation}"></td>
						<td>
						    <form th:action="@{/client/cancel-turn}" method="post">
						        <input type="hidden" name="turnId" th:value="${turno.idTurn}" />
						        <input type="hidden" name="clientId" th:value="${clientId}" />
						        <button type="submit" 
						                th:text="${turno.status.name() == 'CANCELADO' ? 'Reactivar' : 'Cancelar'}">
						        </button>
						    </form>
						</td>
	                </tr>
	            </tbody>
	        </table>
	    </div>
	</div>

</body>
</html>
